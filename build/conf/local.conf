
# Infrabase - Main configuration

BB_NUMBER_THREADS = "20"

# Main target physical/emulated hardware  

# IB_PLATFORM ?= "virt32"
IB_PLATFORM ?= "virt64"
# IB_PLATFORM ?= "rpi4"
# IB_PLATFORM ?= "rpi4_64"

# IB_PLATFORM ?= "x86-qemu"

# Linux General Configuration
 
# Available configurations 
IB_CONFIG:linux:x86-pc ?= "x86_defconfig"
IB_CONFIG:linux:x86-qemu ?= "x86_qemu_defconfig"

# QEMU/virt64 configuration

# This configuration is used to start Linux alone, or on top AVZ
IB_CONFIG:linux:virt64 ?= "virt64_defconfig"
# IB_CONFIG:linux:rpi4_64 ?= "rpi4_64_defconfig"
IB_CONFIG:linux:rpi4_64 ?= "rpi4_64_nomodules_defconfig"

# Configuration to start Linux as agency to support SO3 capsules
#IB_CONFIG:linux:virt64 ?= "virt64_soo_defconfig"

PREFERRED_VERSION_linux:virt32 = "6.12"
PREFERRED_VERSION_linux:virt64 = "6.12"
PREFERRED_VERSION_linux:rpi4_64 = "6.12-rpi4"
PREFERRED_VERSION_linux:x86-qemu = "6.12"
 
# Preferred version for rootfs

# When the rootfs is fully built and user apps are deployed in int

PREFERRED_VERSION_rootfs-linux:virt64 = "1.0"
PREFERRED_VERSION_rootfs-linux:rpi4_64 = "1.0"
PREFERRED_VERSION_rootfs-linux:x86-qemu = "1.0"
PREFERRED_VERSION_buildroot:virt64 = "2024.11"
PREFERRED_VERSION_buildroot:rpi4_64 = "2024.11"

# Main ITS configuration
IB_TARGET_ITS:linux:virt64 ?= "virt64"
IB_TARGET_ITS:linux:rpi4_64 ?= "rpi4"

# ITS used to run Linux on AVZ
#IB_TARGET_ITS:linux:virt64 ?= "virt64_avz"

# Preferred version for bsp

# To deploy from the host to the target via ssh/scp
PREFERRED_VERSION_bsp-linux:x86-qemu = "1.0"
PREFERRED_VERSION_bsp-linux:virt64 = "1.0"
PREFERRED_VERSION_bsp-linux:rpi4_64 = "1.0"

# U-boot bootloader
PREFERRED_VERSION_uboot:virt64 = "2022.04"
PREFERRED_VERSION_uboot:rpi4_64 = "2022.04"

PREFERRED_VERSION_usr-linux:x86-qemu = "1.0"
PREFERRED_VERSION_usr-linux:virt64 = "1.0"
PREFERRED_VERSION_usr-linux:rpi4_64 = "1.0"

PREFERRED_VERSION_linux = "${PREFERRED_VERSION_linux:${IB_PLATFORM}}"

# *************** SO3 ***************

# Using the most recent version
PREFERRED_VERSION_so3:virt64 = "6.1.0"
PREFERRED_VERSION_so3:rpi4_64 = "6.1.0"

# Configuration for SO3

# IB_PLATFORM:so3 ?= "virt64"
# IB_PLATFORM:so3 ?= "virt32"
# IB_PLATFORM:so3 ?= "rpi4"
IB_PLATFORM:so3 ?= "rpi4_64"

IB_CONFIG:so3:virt64 ?= "virt64_defconfig"
# IB_CONFIG:so3:virt64 ?= "virt64_capsule_defconfig"
IB_CONFIG:so3:rpi4_64 ?= "rpi4_64_defconfig"

# Main ITS configuration
IB_TARGET_ITS:so3:virt64 ?= "virt64_so3"
IB_TARGET_ITS:so3:rpi4_64 ?= "rpi4_64_so3"

# This ITS is used to use SO3 as capsule
#IB_TARGET_ITS:so3:virt64  = "virt64_capsule"

# This ITS enables running SO3 on top of AVZ
#IB_TARGET_ITS:so3:virt64  = "virt64_avz_guest"

# *************** AVZ ***************
# AVZ hypervisor General Configuration
PREFERRED_VERSION_avz:virt64 = "6.1.0"

# Configuration for AVZ
#IB_CONFIG:avz:virt64 ?= "virt64_avz_defconfig"
IB_CONFIG:avz:virt64 ?= "virt64_avz_soo_defconfig"

# Type of deployment (soft for virtual storage, hard for target hardware)

IB_STORAGE:virt64 ?= "soft"
IB_STORAGE:rpi4_64 ?= "hard"
# IB_STORAGE ?= "remote"

# When deployed locally (for example on the PC where the build system is running)
# IB_STORAGE ?= "local"

# Possible hardware device for deployment
# !! BE VERY CAREFUL WITH THIS VARIABLE !!

IB_STORAGE_DEVICE:rpi4 = "mmcblk0"
IB_STORAGE_DEVICE:rpi4_64 = "mmcblk0"

# Size of the rootfs partition
IB_ROOTFS_SIZE ?= "2G"

# Target partition for the main rootfs

IB_ROOTFS_PARTITION:virt32 = "p2"
IB_ROOTFS_PARTITION:virt64 = "p2"
IB_ROOTFS_PARTITION:rpi4 = "p2"
IB_ROOTFS_PARTITION:rpi4_64 = "p2"

IB_ROOTFS_PARTITION:x86-qemu = "p1"

IB_ROOTFS_PATH:linux = "${IB_DIR}/linux/rootfs"
IB_ROOTFS_PATH:so3 = "${IB_DIR}/so3/rootfs"

IB_ROOTFS_METHOD ?= "buildroot"
# IB_ROOTFS_METHOD ?= "debootstrap"

# CPU core and toolchain according to the platform

IB_PLAT_CPU:virt32 = "arm"
IB_PLAT_CPU:rpi4 = "arm"

IB_PLAT_CPU:virt64 = "aarch64"
IB_PLAT_CPU:rpi4_64 = "aarch64"

IB_PLAT_CPU:x86-qemu = "x86"

IB_TOOLCHAIN:arm = "arm-linux-gnueabihf"
IB_TOOLCHAIN:virt64 = "aarch64-none-linux-gnu"
IB_TOOLCHAIN:rpi4_64 = "aarch64-none-linux-gnu"
 
# Debug options
# IB_USR_BUILD_TYPE = "Release"
IB_USR_BUILD_TYPE = "Debug"

# This will be used in the future 
# ARM Trusted Firmware platform
# IB_ATF_PLAT = "imx8qx"

BB_NO_NETWORK_SANDBOX = "1"
BB_WARN_ONLY = "true"

# EXTRA_OVERRIDES enables fine-grained customization for the various IB recipes.
#EXTRA_OVERRIDES .= ":soo"
EXTRA_OVERRIDES .= ":lvgl"
#EXTRA_OVERRIDES .= ":lvgl:soo"
